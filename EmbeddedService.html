<html>
	<head><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"></head>
	<script type='text/javascript'>
	
	// Parse URL
	var params = new URLSearchParams(window.location.search);

	// Extract specific parameters
	var utmCampaign = params.get('utm_campaign') || '';
	var utmMedium   = params.get('utm_medium')   || '';
	var gclid       = params.get('gclid')        || '';

	var siteLang = 'en_US'; // default fallback language
	var country = 'US'; //default Country

	function initEmbeddedMessaging() {
		try {
			
			var url = window.location.href || 'https://www.equinix.com/';

			var urlPathVariables = window.location.pathname.match(/^\/([a-z]{2})(?:\/([a-z]{2}))?/i);

			if(urlPathVariables) {
			    country = urlPathVariables[1].toUpperCase() || 'US'; 
			}

			var countryLangMap = new Map([
				['US', 'en_US'], ['BR', 'pt_BR'], ['MX', 'es_MX'],
				['FR', 'fr'], ['ES', 'es'], ['JP', 'ja'],['DE', 'de'],['IT', 'it'],
				// For Korean Website set the language as 'en_US' instead of 'ko'
				['KR', 'en_US']
        	]);

			if(countryLangMap.get(country)!= undefined) {
				siteLang = countryLangMap.get(country);
        	}
			console.log('Detected site language for MIAW:', siteLang);
			
			embeddedservice_bootstrap.settings.language = siteLang; // passing site language dynamically

			embeddedservice_bootstrap.init(
				'00DcV000002QNnp',
				'Eq_MIAW_Web_Msg',
				'https://equinix--mktgaf.sandbox.my.site.com/ESWEqMIAWWebMsg1759324828854',
				{
					scrt2URL: 'https://equinix--mktgaf.sandbox.my.salesforce-scrt.com'
				}
			);
		} catch (err) {
			console.error('Error loading Embedded Messaging: ', err);
		}
	};

	
	//Passing Web Context to Prechat - BEGIN

	window.addEventListener("onEmbeddedMessagingReady", e => {
        //log event
        console.log("onEmbeddedMessagingReady event triggered");
      
        //Set invisible prechat field
        embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
			Google_Click_Id : gclid,
			UTM_campaign : utmCampaign,
			UTM_Medium : utmMedium
        });
    });
    //Passing Web Context to Prechat - END


</script>
<script type='text/javascript' src='https://equinix--mktgaf.sandbox.my.site.com/ESWEqMIAWWebMsg1759324828854/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>
</html>
